/**
 * LBS mSlideIMG 
 * Date: 2014-5-11 
 **/
!function(a,b){"use strict";a.mSlideIMG=function(a){a=a||{},void 0!==a.mslide&&(this.mslide="string"==typeof a.mslide?b.querySelector(a.mslide):a.mslide,void 0!==a.mcontent&&(this.mcontent="string"==typeof a.mcontent?b.querySelector(a.mcontent):a.mcontent,this.mcontents=this.mcontent.children,this.length=this.mcontents.length,this.length<1||(a.index>this.length-1&&(a.index=this.length-1),this.index=this.oIndex=a.index||0,this.mnav=null,this.mnavs=[],this.navShow=a.navShow===!1?!1:!0,this.navClass=a.navClass||"mnav",this.current=a.current||"current",this.auto=!!a.auto||!1,this.auto&&(this.delay=a.delay||5e3),this.duration=a.duration||400,this.timer=null,this.timeid=null,this.touch={},this.cache={},this.init())))},mSlideIMG.prototype={init:function(a){this.navShow&&this.createNav(),this.initSet(),this.bind()},initSet:function(){this.refix();for(var a=0;a<this.length;a++)"left"!==this.css(this.mcontents[a],"cssFloat")&&(this.mcontents[a].style.cssFloat="left"),"absolute"===this.css(this.mcontents[a],"position")&&(this.mcontents[a].style.position="relative"),this.mcontents[a].className=this.mcontents[a].className.replace(this.current,"");this.navShow&&(this.mnavs[this.index].className+=" "+this.current),this.mcontents[this.index].className+=" "+this.current},refix:function(){this.width=b.documentElement.clientWidth||b.body.clientWidth,this.mcontent.style.width=this.length*this.width+"px";for(var a=0;a<this.length;a++)this.mcontents[a].style.width=this.width+"px";this.setTransform(-this.index*this.width)},createNav:function(){this.mnav=b.createElement("ul");for(var a=null,c=0;c<this.length;c++)a=b.createElement("li"),this.mnavs.push(a),this.mnav.appendChild(a);this.mnav.className=this.navClass,this.mslide.appendChild(this.mnav)},bind:function(){var a=this;this.on(this.mslide,["touchstart","pointerdown","MSPointerDown"],function(b){a.touchStart(b),a.auto&&a.stop()}),this.on(this.mslide,["touchmove","pointermove","MSPointerMove"],function(b){a.touchMove(b),a.auto&&a.stop()}),this.on(this.mslide,["touchend","touchcancel","pointerup","pointercancel","MSPointerUp","MSPointerCancel"],function(b){a.touchEnd(b),a.auto&&a.play()}),this.on(this.mcontent,["transitionEnd","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd"],function(b){a.transitionEnd(b)}),this.on(window,["resize","orientationchange"],function(b){a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.refix()},100)}),this.auto&&this.play()},touchStart:function(a){var b=a.touches?a.touches[0]:a;this.touch.x=b.pageX,this.touch.y=b.pageY,this.touch.time=Date.now(),this.touch.disX=0,this.touch.disY=0,this.touch.fixed=""},touchMove:function(a){if("up"!==this.touch.fixed){var b=a.touches?a.touches[0]:a;this.touch.disX=b.pageX-this.touch.x,this.touch.disY=b.pageY-this.touch.y,""===this.touch.fixed&&(Math.abs(this.touch.disY)>Math.abs(this.touch.disX)?this.touch.fixed="up":this.touch.fixed="left"),"left"===this.touch.fixed&&(a.stopPropagation(),a.preventDefault(),(0===this.index&&this.touch.disX>0||this.index===this.length-1&&this.touch.disX<0)&&(this.touch.disX/=4),this.setTransform(this.touch.disX-this.index*this.width))}},touchEnd:function(a){if("left"===this.touch.fixed){var b=Math.abs(this.touch.disX);(Date.now()-this.touch.time>50&&b>10||b>this.width/2)&&(this.touch.disX>0?this.index--:this.index++,this.index<0&&(this.index=0),this.index>this.length-1&&(this.index=this.length-1),this.index!==this.oIndex&&this.update()),this.setTransition(this.duration),this.setTransform(-this.index*this.width)}},transitionEnd:function(){this.setTransition()},update:function(){this.navShow&&(this.mnavs[this.index].className+=" "+this.current,this.mnavs[this.oIndex].className=this.mnavs[this.oIndex].className.replace(this.current,"").trim()),this.mcontents[this.index].className+=" "+this.current,this.mcontents[this.oIndex].className=this.mcontents[this.oIndex].className.replace(this.current,"").trim(),this.oIndex=this.index},on:function(a,b,c){if("string"==typeof b)return a.addEventListener(b,c,!1);for(var d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c,!1)},css:function(a,b){return getComputedStyle(a,null)[b]},setTransition:function(a){a=a||0,this.setStyle(this.mcontent,"transition","all "+a+"ms")},setTransform:function(a){a=a||0,this.setStyle(this.mcontent,"transform","translate3d("+a+"px,0px,0px)")},setStyle:function(a,b,c){!this.cache[a]&&(this.cache[a]={}),!this.cache[a][b]&&(this.cache[a][b]=this.prefix(b)),a.style[this.cache[a][b]||this.prefix(b)]=c},prefix:function(a){var b=document.createElement("div").style;if(a in b)return a;for(var c=["webkit","Moz","ms","O"],d=0,e=c.length,f="";e>d;d++)if(f=c[d]+"-"+a,f=f.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()}),f in b)return f},play:function(){function a(){b.index++,b.index>b.length-1&&(b.index=0),b.setTransition(b.duration),b.setTransform(-b.index*b.width),b.index!==b.oIndex&&b.update(),b.timeid=setTimeout(a,b.delay)}if(this.length<2)return void this.stop();var b=this;this.timeid=setTimeout(a,this.delay)},stop:function(){this.timeid&&clearTimeout(this.timeid),this.timeid=null}}}(window,document);